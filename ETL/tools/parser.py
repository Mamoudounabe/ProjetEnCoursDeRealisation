import os

def convert_csv_encoding():
    """
    Convertit les fichiers CSV en utf-8.
    """
    #on verifie si le fichier est en utf-8 sinon on le convertit
    for file in os.listdir("ETL/data"):
        if file.endswith(".csv"):
            with open(f"ETL/data/{file}", "r") as f:
                content = f.read()
            try:
                content.encode("utf-8").decode("utf-8")
            except UnicodeDecodeError:
                with open(f"ETL/data/{file}", "w", encoding="utf-8") as f:
                    f.write(content)

# Entetes des fichiers CSV pour les années 2020 et les années suivantes
entete = [
    "session;statut_etablissement_filiere;code_uai_etablissement;etablissement;code_departement_etablissement;departement_etablissement;region_etablissement;academie_etablissement;selectivite;filiere_formation_tres_agregee;filiere_formation_detaillee;filiere_formation;concours_communs_banque_epreuves;filiere_formation_detailee;filiere_formation_tres_detailee;lien_parcoursup;coordonnees_gps_formation;capacite_etablissement_formation;effectif_total_candidats_formation;effectif_candidates_formation;effectif_total_candidats_phase_principale;effectif_candidats_internat_phase_principale;effectif_neo_bacheliers_generaux_phase_principale;effectif_boursiers_generaux_phase_principale;effectif_neo_bacheliers_technologiques_phase_principale;effectif_boursiers_technologiques_phase_principale;effectif_neo_bacheliers_professionnels_phase_principale;effectif_boursiers_professionnels_phase_principale;effectif_autres_candidats_phase_principale;effectif_total_candidats_phase_complementaire;effectif_neo_bacheliers_generaux_phase_complementaire;effectif_neo_bacheliers_technologiques_phase_complementaire;effectif_neo_bacheliers_professionnels_phase_complementaire;effectif_autres_candidats_phase_complementaire;effectif_total_candidats_classes_phase_principale;effectif_candidats_classes_phase_complementaire;effectif_candidats_classes_internat_cpge;effectif_candidats_classes_hors_internat_cpge;effectif_neo_bacheliers_generaux_classes;effectif_boursiers_generaux_classes;effectif_neo_bacheliers_technologiques_classes;effectif_boursiers_technologiques_classes;effectif_neo_bacheliers_professionnels_classes;effectif_boursiers_professionnels_classes;effectif_autres_candidats_classes;effectif_total_candidats_proposition_admission;effectif_total_candidats_admis;effectif_candidates_admises;effectif_admis_phase_principale;effectif_admis_phase_complementaire;effectif_admis_proposition_ouverture_phase_principale;effectif_admis_proposition_avant_baccalaureat;effectif_admis_proposition_avant_fin_procedure_principale;effectif_admis_internat;effectif_boursiers_admis;effectif_neo_bacheliers_admis;effectif_generaux_admis;effectif_technologiques_admis;effectif_professionnels_admis;effectif_autres_admis;effectif_neo_bacheliers_sans_info_mention_bac_admis;effectif_neo_bacheliers_sans_mention_bac_admis;effectif_neo_bacheliers_mention_assez_bien_bac_admis;effectif_neo_bacheliers_mention_bien_bac_admis;effectif_neo_bacheliers_mention_tres_bien_bac_admis;effectif_generaux_mention_bac_admis;effectif_technologiques_mention_bac_admis;effectif_professionnels_mention_bac_admis;effectif_admis_meme_etablissement_bts_cpge;effectif_admises_meme_etablissement_bts_cpge;effectif_admis_meme_academie;effectif_admis_meme_academie_paris_creteil_versailles;proportion_admis_proposition_ouverture_phase_principale;proportion_admis_proposition_avant_baccalaureat;proportion_admis_proposition_avant_fin_procedure_principale;proportion_admis_filles;proportion_neo_bacheliers_meme_academie;proportion_neo_bacheliers_meme_academie_paris_creteil_versailles;proportion_neo_bacheliers_meme_etablissement_bts_cpge;proportion_neo_bacheliers_boursiers;proportion_neo_bacheliers_admis;proportion_neo_bacheliers_sans_info_mention_bac_admis;proportion_neo_bacheliers_sans_mention_bac_admis;proportion_neo_bacheliers_mention_assez_bien_bac_admis;proportion_neo_bacheliers_mention_bien_bac_admis;proportion_neo_bacheliers_mention_tres_bien_bac_admis;proportion_generaux_admis_mention_bac;proportion_technologiques_admis_mention_bac;proportion_professionnels_admis_mention_bac;effectif_candidats_terminal_generale_proposition_admission;effectif_boursiers_terminal_generale_proposition_admission;effectif_candidats_terminal_technologique_proposition_admission;effectif_boursiers_terminal_technologique_proposition_admission;effectif_candidats_terminal_professionnelle_proposition_admission;effectif_boursiers_terminal_generale_professionnelle_proposition_admission;effectif_autres_candidats_proposition_admission;regroupement_1_classement;rang_dernier_appele_groupe_1;regroupement_2_classement;rang_dernier_appele_groupe_2;regroupement_3_classement;rang_dernier_appele_groupe_3;regroupement_4_classement;rang_dernier_appele_groupe_4;regroupement_5_classement;rang_dernier_appele_groupe_5;indicateur_taux_acces_parcoursup;indicateur_taux_acces_bac_professionnel;indicateur_taux_acces_bac_general;indicateur_taux_acces_bac_technologique;tri;cod_aff_form;Column1;_1;_2",
    "session;statut_etablissement_filiere;code_uai_etablissement;etablissement;code_departement_etablissement;departement_etablissement;region_etablissement;academie_etablissement;commune_etablissement;selectivite;filiere_formation_tres_agregee;filiere_formation_detaillee;filiere_formation;filiere_formation_1;filiere_formation_taille_bis;filiere_formation_tres_detaillee;concours_communs_et_banque_d_epreuves;coordonnees_gps_de_la_formation;capacite_de_l_etablissement_par_formation;effectif_total_des_candidats_pour_une_formation;dont_effectif_des_candidates_pour_une_formation;effectif_total_des_candidats_en_phase_principale;dont_effectif_des_candidats_ayant_postule_en_internat;effectif_des_candidats_neo_bacheliers_generaux_en_phase_principale;dont_effectif_des_candidats_boursiers_neo_bacheliers_generaux_en_phase_principale;effectif_des_candidats_neo_bacheliers_technologiques_en_phase_principale;dont_effectif_des_candidats_boursiers_neo_bacheliers_technologiques_en_phase_principale;effectif_des_candidats_neo_bacheliers_professionnels_en_phase_principale;dont_effectif_des_candidats_boursiers_neo_bacheliers_professionnels_en_phase_principale;effectif_des_autres_candidats_en_phase_principale;effectif_total_des_candidats_en_phase_complementaire;effectif_des_candidats_neo_bacheliers_generaux_en_phase_complementaire;effectif_des_candidats_neo_bacheliers_technologique_en_phase_complementaire;effectif_des_candidats_neo_bacheliers_professionnels_en_phase_complementaire;effectifs_des_autres_candidats_en_phase_complementaire;effectif_total_des_candidats_classes_par_l_etablissement_en_phase_principale;effectif_des_candidats_classes_par_l_etablissement_en_phase_complementaire;effectif_des_candidats_classes_par_l_etablissement_en_internat_cpge;effectif_des_candidats_classes_par_l_etablissement_hors_internat_cpge;effectif_des_candidats_neo_bacheliers_generaux_classes_par_l_etablissement;dont_effectif_des_candidats_boursiers_neo_bacheliers_generaux_classes_par_l_etablissement;effectif_des_candidats_neo_bacheliers_technologiques_classes_par_l_etablissement;dont_effectif_des_candidats_boursiers_neo_bacheliers_technologiques_classes_par_l_etablissement;effectif_des_candidats_neo_bacheliers_professionnels_classes_par_l_etablissement;dont_effectif_des_candidats_boursiers_neo_bacheliers_professionnels_classes_par_l_etablissement;effectif_des_autres_candidats_classes_par_l_etablissement;effectif_total_des_candidats_ayant_recu_une_proposition_d_admission_de_la_part_de_l_etablissement;effectif_total_des_candidats_ayant_accepte_la_proposition_de_l_etablissement_admis;dont_effectif_des_candidates_admises;effectif_des_admis_en_phase_principale;effectif_des_admis_en_phase_complementaire;dont_effectif_des_admis_ayant_recu_leur_proposition_d_admission_a_l_ouverture_de_la_procedure_principale;dont_effectif_des_admis_ayant_recu_leur_proposition_d_admission_avant_le_baccalaureat;dont_effectif_des_admis_ayant_recu_leur_proposition_d_admission_avant_la_fin_de_la_procedure_principale;dont_effectif_des_admis_en_internat;dont_effectif_des_admis_boursiers_neo_bacheliers;effectif_des_admis_neo_bacheliers;effectif_des_admis_neo_bacheliers_generaux;effectif_des_admis_neo_bacheliers_technologiques;effectif_des_admis_neo_bacheliers_professionnels;effectif_des_autres_candidats_admis;dont_effectif_des_admis_neo_bacheliers_sans_information_sur_la_mention_au_bac;dont_effectif_des_admis_neo_bacheliers_sans_mention_au_bac;dont_effectif_des_admis_neo_bacheliers_avec_mention_as_sez_bien_au_bac;dont_effectif_des_admis_neo_bacheliers_avec_mention_bien_au_bac;dont_effectif_des_admis_neo_bacheliers_avec_mention_tres_bien_au_bac;dont_effectif_des_admis_neo_bacheliers_avec_mention_tres_bien_avec_felicitation_au_bac;effectif_des_admis_neo_bacheliers_generaux_ayant_eu_une_mention_au_bac;effectif_des_admis_neo_bacheliers_technologiques_ayant_eu_une_mention_au_bac;effectif_des_admis_neo_bacheliers_professionnels_ayant_eu_une_mention_au_bac;dont_effectif_des_admis_issus_du_meme_etablissement_bts_cpge;dont_effectif_des_admises_issues_du_meme_etablissement_bts_cpge;dont_effectif_des_admis_issus_de_la_meme_academie;dont_effectif_des_admis_issus_de_la_meme_academie_paris_creteil_versailles_reunies;proportion_d_admis_ayant_recu_leur_proposition_d_admission_a_l_ouverture_de_la_procedure_principale;proportion_d_admis_ayant_recu_leur_proposition_d_admission_avant_le_baccalaureat;proportion_d_admis_ayant_recu_leur_proposition_d_admission_avant_la_fin_de_la_procedure_principale;proportion_d_admis_dont_filles;proportion_d_admis_neo_bacheliers_issus_de_la_meme_academie;proportion_d_admis_neo_bacheliers_issus_de_la_meme_academie_paris_creteil_versailles_reunies;proportion_d_admis_neo_bacheliers_issus_du_meme_etablissement_bts_cpge;proportion_d_admis_neo_bacheliers_boursiers;proportion_d_admis_neo_bacheliers;proportion_d_admis_neo_bacheliers_sans_information_sur_la_mention_au_bac;proportion_d_admis_neo_bacheliers_sans_mention_au_bac;proportion_d_admis_neo_bacheliers_avec_mention_as_sez_bien_au_bac;proportion_d_admis_neo_bacheliers_avec_mention_bien_au_bac;proportion_d_admis_neo_bacheliers_avec_mention_tres_bien_au_bac;proportion_d_admis_neo_bacheliers_avec_mention_tres_bien_avec_felicitation_au_bac;proportion_d_admis_neo_bacheliers_generaux;dont_proportion_d_admis_avec_mention_bg;proportion_d_admis_neo_bacheliers_technologiques;dont_proportion_d_admis_avec_mention_bt;proportion_d_admis_neo_bacheliers_professionnels;dont_proportion_d_admis_avec_mention_bp;effectif_des_candidats_en_terminal_generale_ayant_recu_une_proposition_d_admission_de_la_part_de_l_etablissement;dont_effectif_des_candidats_boursiers_en_terminal_generale_ayant_recu_une_proposition_d_admission_de_la_part_de_l_etablissement;effectif_des_candidats_en_terminal_technologique_ayant_recu_une_proposition_d_admission_de_la_part_de_l_etablissement;dont_effectif_des_candidats_boursiers_en_terminal_technologique_ayant_recu_une_proposition_d_admission_de_la_part_de_l_etablissement;effectif_des_candidats_en_terminal_professionnelle_ayant_recu_une_proposition_d_admission_de_la_part_de_l_etablissement;dont_effectif_des_candidats_boursiers_en_terminal_generale_professionnelle_ayant_recu_une_proposition_d_admission_de_la_part_de_l_etablissement;effectif_des_autres_candidats_ayant_recu_une_proposition_d_admission_de_la_part_de_l_etablissement;regroupement_1_effectue_par_les_formations_pour_les_classements;rang_du_dernier_appele_du_groupe_1;regroupement_2_effectue_par_les_formations_pour_les_classements;rang_du_dernier_appele_du_groupe_2;regroupement_3_effectue_par_les_formations_pour_les_classements;rang_du_dernier_appele_du_groupe_3;list_com;tri;cod_aff_form;lien_de_la_formation_sur_la_plateforme_parcoursup;taux_d_acces_des_candidats_ayant_postule_a_la_formation_ratio_entre_le_dernier_appele_et_le_nombre_voeux_pp;dont_taux_d_acces_des_candidats_ayant_un_bac_general_ayant_postule_a_la_formation;dont_taux_d_acces_des_candidats_ayant_un_bac_technologique_ayant_postule_a_la_formation;dont_taux_d_acces_des_candidats_ayant_un_bac_professionnel_ayant_postule_a_la_formation;etablissement_id_paysage;composante_id_paysage",
]

def header_modification(file):
    """
    Modifie l'entete des fichiers CSV selon les années.
    """
    # on supprime l'entete actuel et on le remplace pour l'année 2020 avec le premier entete et pour le reste des années avec le deuxième entete
    with open(f"ETL/data/{file}", "r", encoding="utf-8") as f:
        lines = f.readlines()
    if file == "2020.csv":
        lines[0] = entete[0] + "\n"
    else:
        lines[0] = entete[1] + "\n"

    with open(f"ETL/data/{file}", "w", encoding="utf-8") as f:
        f.writelines(lines)

def modify_headers():
    """
    Modifie les entetes des fichiers CSV.
    """
    for file in os.listdir("ETL/data"):
        if file.endswith(".csv"):
            header_modification(file)