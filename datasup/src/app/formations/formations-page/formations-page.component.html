<section class="decalerdroite">
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Chargement des formations en cours...</p>
  </div>
  
  <div class="statistique-logo">
    <svg class="fontawesomesvg rotate" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="30" height="30">
      <path fill="red" d="M384 160c-17.7 0-32-14.3-32-32s14.3-32 32-32H544c17.7 0 32 14.3 32 32V288c0 17.7-14.3 32-32 32s-32-14.3-32-32V205.3L342.6 374.6c-12.5 12.5-32.8 12.5-45.3 0L192 269.3 54.6 406.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l160-160c12.5-12.5 32.8-12.5 45.3 0L320 306.7 466.7 160H384z"/>
    </svg>
    <span class="stat-text">Statistiques par formation</span>
  </div>
  
  <div class="search-bar">
    <h2>Rechercher une formation</h2>
    <input
      type="text"
      placeholder='Rechercher une formation, ex: "Licence Informatique", "Licence Dijon", "Informatique", "BUT Informatique Dijon", "Dijon", etc.'
      aria-label="Search"
      [(ngModel)]="searchQuery"
      (input)="filterFormations()">
  </div>
  
  <div class="formation-table">
    <table>
      <thead>
        <tr>
          <th>
            <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">
              Établissement
            </div>
            <div style="border-top: 2px solid #ccc; padding-top: 30px;">
              <input 
                type="text" 
                [(ngModel)]="searchEtablissement" 
                placeholder="" 
                (input)="filterFormations()"
                aria-label="Rechercher un établissement"
                style="width: 100%; height: 40px; padding: 8px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9;">
            </div>
          </th>
          <th>
            <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">
              Commune
            </div>
            <div style="border-top: 2px solid #ccc; padding-top: 30px;">
              <input 
                type="text" 
                [(ngModel)]="searchCommune" 
                placeholder="" 
                (input)="filterFormations()"
                aria-label="Rechercher une commune"
                style="width: 100%; height: 40px; padding: 8px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9;">
            </div>
          </th>
          <th>
            <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">
              Académie
            </div>
            <div style="border-top: 2px solid #ccc; padding-top: 30px;">
              <input 
                type="text" 
                [(ngModel)]="searchAcademie" 
                placeholder="" 
                (input)="filterFormations()"
                aria-label="Rechercher une académie"
                style="width: 100%; height: 40px; padding: 8px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9;">
            </div>
          </th>
          <th>
            <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">
              Filière
            </div>
            <div style="border-top: 2px solid #ccc; padding-top: 30px;">
              <input 
                type="text" 
                [(ngModel)]="searchFiliere" 
                placeholder="" 
                (input)="filterFormations()"
                aria-label="Rechercher une filière"
                style="width: 100%; height: 40px; padding: 8px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9;">
            </div>
          </th>
          <th>
            <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">
              Filière détaillée
            </div>
            <div style="border-top: 2px solid #ccc; padding-top: 30px;">
              <input 
                type="text" 
                [(ngModel)]="searchFiliereDetaillee" 
                placeholder="" 
                (input)="filterFormations()"
                aria-label="Rechercher une filière détaillée"
                style="width: 100%; height: 40px; padding: 8px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9;">
            </div>
          </th>
          <th>
            <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">
              Filière très détaillée
            </div>
            <div style="border-top: 2px solid #ccc; padding-top: 30px;">
              <input 
                type="text" 
                [(ngModel)]="searchFiliereTresDetaillee" 
                placeholder="" 
                (input)="filterFormations()"
                aria-label="Rechercher une filière très détaillée"
                style="width: 100%; height: 40px; padding: 8px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9;">
            </div>
          </th>
          <th>
            <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">
              Statut
            </div>
            <div style="border-top: 2px solid #ccc; padding-top: 30px;">
              <input 
                type="text" 
                [(ngModel)]="searchStatut" 
                placeholder="" 
                (input)="filterFormations()"
                aria-label="Rechercher un statut"
                style="width: 100%; height: 40px; padding: 8px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9;">
            </div>
          </th>
          <th>
            <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">
              Sélectivité
            </div>
            <div style="border-top: 2px solid #ccc; padding-top: 30px;">
              <input 
                type="text" 
                [(ngModel)]="searchSelectivite" 
                placeholder="" 
                (input)="filterFormations()"
                aria-label="Rechercher une sélectivité"
                style="width: 100%; height: 40px; padding: 8px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9;">
            </div>
          </th>
          <th>
            <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">
              Nombre d'admis
            </div>
            <mat-slider min="0" max="100000" step="1000" showTickMarks discrete [displayWith]="formatLabel">
              <input matSliderThumb>
            </mat-slider>
          </th>
        </tr>
      </thead>
      <tbody *ngIf="filteredFormations.length > 0">
        <tr *ngFor="let formation of filteredFormations" (click)="goToFormation(formation.id_etablissement)">
          <td>{{ formation.etablissement }}</td>
          <td [ngClass]="{'non-disponible': !formation.commune_etablissement}">
            {{ formation.commune_etablissement || 'Non disponible' }}
          </td>
          <td>{{ formation.academie_etablissement }}</td>
          <td>{{ formation.filiere_formation }}</td>
          <td>{{ formation.filiere_formation_detaillee }}</td>
          <td [ngClass]="{'non-disponible': !formation.filiere_formation_tres_detaillee}">
            {{ formation.filiere_formation_tres_detaillee || 'Non disponible' }}
          </td>
          <td>{{ formation.statut_etablissement_filiere }}</td>
          <td>{{ formation.selectivite }}</td>
          <td [ngClass]="{'non-disponible': !formation.effectif_total_candidats_admis}">
            {{ formation.effectif_total_candidats_admis || 'Non disponible' }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>
  
<mat-paginator class="custom-paginator"
[length]="totalItems"
[pageSize]="pageSize"
[pageSizeOptions]="[5, 10, 25, 100]"
aria-label="Select page"
(page)="onPageChange($event)">
</mat-paginator>

  